apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  vpm-mini-dev-overview.json: |
    {
      "id": null,
      "title": "VPM Mini / Dev Overview",
      "timezone": "browser",
      "schemaVersion": 39,
      "version": 1,
      "refresh": "10s",
      "panels": [
        {
          "type": "stat",
          "title": "up (targets alive)",
          "gridPos": {"x":0,"y":0,"w":8,"h":6},
          "targets": [
            { "expr": "sum(up)", "legendFormat": "alive" }
          ]
        },
        {
          "type": "timeseries",
          "title": "Requests/sec (all jobs)",
          "gridPos": {"x":8,"y":0,"w":16,"h":6},
          "targets": [
            { "expr": "rate(prometheus_tsdb_head_series{job=\"prometheus\"}[1m])", "legendFormat": "prom series rate" }
          ]
        },
        {
          "type": "timeseries",
          "title": "Node CPU (kind node, sample)",
          "gridPos": {"x":0,"y":6,"w":12,"h":7},
          "targets": [
            { "expr": "sum(rate(container_cpu_usage_seconds_total{image!=\"\",container!=\"POD\"}[2m]))", "legendFormat": "cpu total" }
          ]
        },
        {
          "type": "timeseries",
          "title": "Node Memory (working set)",
          "gridPos": {"x":12,"y":6,"w":12,"h":7},
          "targets": [
            { "expr": "sum(container_memory_working_set_bytes{image!=\"\",container!=\"POD\"})", "legendFormat": "mem working set" }
          ]
        }
      ],
      "templating": { "list": [] }
    }
  evidence-prod.json: |
    {
      "uid": "evidence-prod",
      "title": "Evidence \\u2013 Prod",
      "schemaVersion": 39,
      "version": 1,
      "refresh": "5m",
      "timezone": "browser",
      "panels": [
        {
          "id": 1,
          "type": "text",
          "title": "Daily Evidence Placeholder",
          "gridPos": { "x": 0, "y": 0, "w": 24, "h": 9 },
          "options": {
            "mode": "markdown",
            "content": "# Evidence\\nPlaceholder panel rendered for tests."
          }
        }
      ],
      "templating": { "list": [] }
    }
