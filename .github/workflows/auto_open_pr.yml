name: auto-open-pr
on:
  push:
    branches:
      - feat/cli-run-all-pipeline

jobs:
  open-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
      - name: Create or update PR to main
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          base: main
          branch: feat/cli-run-all-pipeline
          title: "feat(cli): add `run-all` pipeline (logâ†’summaryâ†’digestâ†’navâ†’egspace)"
          body: |
            ## ç›®çš„ (Purpose)
            - Why: å„å‡¦ç†ã‚’ãƒãƒ©ãƒãƒ©ã«å®Ÿè¡Œã›ãšã€1 æ“ä½œã§ end-to-end ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å›ã™
            - What: CLI ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ `run-all` ã‚’è¿½åŠ ï¼ˆlogâ†’summaryâ†’digestâ†’navâ†’egspace ä¸€å·¡ï¼‰

            ## å¤‰æ›´ç‚¹ (Changes)
            - [x] cli.py ã« `run-all` ã‚’è¿½åŠ ï¼ˆæ—¢å­˜ãƒ¢ãƒ¼ãƒ‰ã¯ç¶­æŒï¼‰
            - [x] ä¸€é€£ã®å‡¦ç†ã‚’çµ±åˆï¼ˆlog_turns â†’ summary â†’ digest_state â†’ nav_mermaid â†’ egspace_eventsï¼‰
            - [x] CLI çµ±åˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ï¼ˆ3ä»¶ï¼‰

            ## å‹•ä½œç¢ºèª (How to verify)
            - [x] `python cli.py run-all "ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"` ã§ 5 ç”Ÿæˆç‰©ãŒä¸€æ‹¬æ›´æ–°
              1. logs: `logs/YYYY-MM-DD.jsonl`
              2. memory: `memory.json` å…ˆé ­ã« â‰¤400 å­—è¦ç´„
              3. digest: `docs/sessions/YYYY-MM-DD_digest.md`ï¼ˆrefs: [vec_id] â†’ raw_refï¼‰
              4. nav: `diagrams/src/YYYY-MM-DD_nav.md`ï¼ˆãƒãƒ¼ãƒ‰ã« [session_â€¦]ï¼‰
              5. egspace: `egspace/events.jsonl` / `egspace/index.json`
            - [x] `pytest -q` â†’ âœ… Green

            ## å®Œäº†æ¡ä»¶ï¼ˆDoDï¼‰
            - 1 æ“ä½œã§ log/memory.json/digest/nav/egspace ãŒæ›´æ–°
            - CI green â†’ è‡ªå‹•ãƒãƒ¼ã‚¸

            ğŸ¤– Generated with [Claude Code](https://claude.ai/code)
          labels: auto