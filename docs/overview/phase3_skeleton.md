## 6. Execution Policy（ソース改修の実行主体）

Phase 3 以降、ソースコードやインフラ設定の改修については、次のポリシーを標準ルートとする。

### 6.1 標準ルート：仕様 → エージェント実行 → PR → 人間レビュー

1. ChatGPT / Planner が「何を・なぜ変えるか」を文章で整理し、仕様（What/Why）として残す。
2. その仕様をもとに、**Codex / LLMリレー / VM Codex 向けの「実行指示書」**を作成する。
3. エージェント（Codex / VM）が、
   - ローカル Mac や VM 上で実行し、
   - 変更内容をログに残しつつ、
   - PR として GitHub に反映する。
4. 人間（啓さん）は、
   - PR のレビュー（意味・整合性・リスクのチェック）
   - マージ判断
   に専念する。

### 6.2 例外ルート：緊急 Hotfix

次の条件を満たす場合に限り、人間が直接ファイルを編集してよい。

- SLO や本番運用に影響する緊急障害であり、
- エージェント経由だと復旧が大きく遅れると判断されるとき

その場合でも、

- 直接編集後に必ず PR またはコミットコメントで理由を明記し、
- 必要に応じて `STATE/current_state.md` や `reports/**` に
  「なぜ例外ルートを使ったか」を一言記録する。

### 6.3 レビューの役割分担

- 人間（啓さん）は、レビューにおいて
  - ゴールとの整合性（EG-Space / North Star との一貫性）
  - リスク・副作用
  - ドメイン知識（ビジネスロジック）
  に集中する。
- コーディングスタイルや細かい記法は、
  - エージェント側の生成
  - 自動フォーマッタ / Lint
  に任せる。

### 6.4 権限と実行環境の境界（現状 → 将来）

- 現状（Phase 2〜3 前半）：
  - ローカル Mac 上の Codex が「補助的な実行者」として動き、vpm-mini のソース改修や Git 操作を代行する。
- 将来（Phase 3 後半〜4）：
  - 書き込み権限を持つレーンを、VM Codex や LLMリレーなど **限定された実行環境**に集約する。
  - ローカル Mac は、
    - 一時的な検証
    - 緊急時のバックアップ
    の位置づけとし、通常運用からは徐々に切り離す。

このポリシーにより、

- 「仕様は ChatGPT / Planner が書く」
- 「実行はエージェントが行う」
- 「人間はレビューと判断に集中する」

という役割分担を Phase 3 の基本形とする。

## 7. Phase 3 セル候補一覧（Draft）

Phase 3 で扱う「セル」（またはセル群）の候補を、ラフな一覧として棚卸ししておく。
ここでの一覧はあくまでドラフトであり、Phase 3 の進行に合わせて増減・名前変更していく前提とする。

| Cell key        | 説明                                              | 主なレーン / 役割                                      | u_contract カテゴリ（案）      | /ask 対応状況（案）                  | 備考                                  |
|-----------------|---------------------------------------------------|--------------------------------------------------------|---------------------------------|--------------------------------------|---------------------------------------|
| hello-s5        | Hello S5 KService / North Star デモセル          | North Star 更新 / /ask update_north_star 模範ケース   | （該当なし）                    | M2 で実績あり（模範セル）            | Phase 2 / M2 でフルループ成立済み     |
| metrics-echo    | metrics-echo KService（監視・SLI 向け）          | 監視 / SLI セル候補（READY / 成功率など）             | `TBD: monitoring-report`        | Phase 3 前半で再チャレンジ予定       | `metrics_echo_design.md` を参照       |
| persist-report  | reports/** 配下のレポートセル群（persist-report）| レポート系セル群 / `persist-report` 半自動レーン      | `persist-report`                | （将来）レポートへの /ask 適用を検討 | Phase 2 / M2 で半自動レーンを確認済み |
| self-cost       | Self-Cost / コスト・基盤ヘルス系セルの候補       | コスト・ランナー利用状況などの可視化                  | `TBD: cost-report`              | （Phase 3 以降で検討）               | 具体的なセル構成は今後設計            |
| other-candidates| その他、Phase 3 で追加したいセルのプレースホルダ | 例: 追加の North Star セル / Biz KPI セルなど         | `TBD`                           | `TBD`                               | 実際の Phase 3 の議論の中で具体化     |

この一覧は、「Phase 3 でどのセルを増やしていくか」を議論するための地図であり、実際の構成や命名は Phase 3 Kickoff 後の議論に応じて更新されることを前提とする。

## 8. セルごとの Phase 3 アクション（Draft）

Phase 3 のマイルストーン (P3-1〜P3-3) ごとに、代表的なセル候補がどのタイミングで何をする想定かをラフに整理しておく。

| Cell key       | P3-1 Skeleton & Cell Map                          | P3-2 Multi-cell /ask & u_contract Loop                                      | P3-3 Self-Cost / 基盤ヘルス系拡張                      |
|----------------|----------------------------------------------------|------------------------------------------------------------------------------|---------------------------------------------------------|
| hello-s5       | 模範セルとして役割を再確認し、設計パターンを整理。 | 基本的には維持。必要に応じて /ask パターンの微調整のみ。                    | 直接の対象外（他セル設計時のリファレンスとして利用）。 |
| metrics-echo   | metrics_echo_design.md をもとに役割と SLI を整理。 | READY / 成功率 SLI に絞った Evidence ラインを整備し、/ask を再チャレンジ。 | 余裕があれば SLO / コスト指標との関係を検討開始。       |
| persist-report | reports/** 配下のセル群として地図上に位置づけ。    | 既存の半自動レーンを維持しつつ、/ask でレポート要約やタグ付けを試行。      | self-cost や他セルの Evidence との連携を検討。         |
| self-cost      | セルとしての役割と North Star 候補を設計。         | Evidence（ランナー使用状況 / 基盤コストなど）の候補を洗い出す。            | 実際の Evidence ラインと /ask フローを構築し始める。   |

この表はあくまでドラフトであり、Phase 3 の進行に応じて増減・変更されることを前提とする。実際のタスク分解やスケジュールは、別途 reports/phase3/ 配下のドキュメントで詳細化していく。
